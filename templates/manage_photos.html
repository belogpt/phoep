{% extends 'base.html' %}
{% block content %}
<h3>Картинки контактов</h3>
<p class="text-muted">Каталог хранения: <code>/app/static/photos</code>. Изображения можно удалить только если они не используются.</p>
<div class="mb-3">
    <a class="btn btn-primary" href="{{ url_for('phonebook.new_contact') }}">Добавить контакт</a>
</div>
<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>Превью</th>
            <th>Имя файла</th>
            <th>Использование</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    {% for photo in photos %}
        <tr>
            <td style="width: 120px;">
                <img src="{{ photo.url }}" alt="{{ photo.filename }}" class="img-thumbnail" style="max-width: 100px; max-height: 100px;">
            </td>
            <td>{{ photo.filename }}</td>
            <td>{% if photo.usage %}Используется {{ photo.usage }}{% if photo.usage == 1 %} контактом{% else %} контактами{% endif %}{% else %}Не используется{% endif %}</td>
            <td class="text-end">
                {% if not photo.usage %}
                <form method="post" action="{{ url_for('phonebook.delete_photo', filename=photo.filename) }}" onsubmit="return confirm('Удалить изображение {{ photo.filename }}?');">
                    <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                </form>
                {% else %}
                <span class="text-muted">Удаление недоступно</span>
                {% endif %}
            </td>
        </tr>
    {% else %}
        <tr><td colspan="4" class="text-muted">Нет загруженных изображений</td></tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
